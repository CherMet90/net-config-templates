{#---
name: cisco-add-bgp-neighbor
description: Добавление BGP-соседа (eBGP/iBGP) на Cisco IOS-XE.
vars:
  local_as:
    type: int
    required: true
    desc: Локальный номер ASN на этом роутере.
    example: 65001

  neighbor_ip:
    type: ip
    required: true
    desc: IP-адрес BGP-соседа (loopback или адрес туннеля).
    example: 10.0.0.1

  neighbor_as:
    type: int
    required: true
    desc: ASN соседа.
    example: 65000

  description:
    type: str
    required: false
    desc: Описание BGP-сессии (для удобства в show-командах).
    default: ""
    example: BGP to HQ

  update_source:
    type: str
    required: true
    desc: Интерфейс-источник BGP-сессии (LoopbackX / TunnelX).
    example: Tunnel1

  prefix_lists_in:
    type: list[str]
    required: false
    desc: Список prefix-list для входящего фильтра (должен быть создан заранее).
    example: [PL-IN-HQ]

  prefix_lists_out:
    type: list[str]
    required: false
    desc: Список prefix-list для исходящего фильтра (должен быть создан заранее).
    example: [PL-OUT-HQ]
---#}
router bgp {{ local_as }}
 neighbor {{ neighbor_ip }} remote-as {{ neighbor_as }}
 neighbor {{ neighbor_ip }} description {{ description | default('') }}
 neighbor {{ neighbor_ip }} update-source {{ update_source }}
 address-family ipv4
  {% if prefix_lists_in is defined %}
  {% for prefix_list in prefix_lists_in %}
  neighbor {{ neighbor_ip }} prefix-list {{ prefix_list }} in
  {% endfor %}
  {% endif %}
  {% if prefix_lists_out is defined %}
  {% for prefix_list in prefix_lists_out %}
  neighbor {{ neighbor_ip }} prefix-list {{ prefix_list }} out
  {% endfor %}
  {% endif %}
  neighbor {{ neighbor_ip }} activate