# Интерактивный генератор конфигураций (render-template-interactive.py)

Инструмент генерирует конфигурацию из Jinja2-шаблона, запрашивая значения переменных в интерактивном режиме.  
Скрипт поддерживает **два режима** работы в зависимости от наличия YAML-docstring в шаблоне.

## Основные возможности

- Автоматически определяет все переменные, используемые в шаблоне.
- **Расширенный режим** (при наличии YAML-docstring):
  - Выводит **описание** каждой переменной, примеры и подсказки.
  - Проверяет **обязательные** поля (`required: true`).
  - Валидирует типы (`int`, `ip`, `cidr`, `list` и т.д.).
  - Учитывает значения по умолчанию из YAML.
  - Переменные запрашиваются в порядке, указанном в YAML.
- **Режим обратной совместимости** (без YAML-docstring):
  - Автоопределение типов (bool, int, float, list, json, str).
  - Поддержка префиксов `:json`, `:list`, `:dict`.
  - Чтение `default` из фильтра `| default(...)` в шаблоне.
- Общие функции:
  - Загрузка/сохранение контекста в JSON (`--context`, `--dump-context`).
  - Вывод результата в файл (`-o`) или stdout.
  - Пустой ввод (Enter) → использование default или пропуск переменной.

## Быстрый старт

```bash
# Простой запуск (stdout)
python tools/render-template-interactive.py \
  templates/cisco/ios-xe/add-bgp-neighbor.j2
```

```bash
# Сохранить конфиг + контекст
python tools/render-template-interactive.py \
  templates/mikrotik/routeros-7.x/add-ebgp-neighbor.rsc.j2 \
  -o output/SITE001_ebgp.rsc \
  --dump-context inventory/SITE001_ebgp.json
```

```bash
# Повторное использование контекста
python tools/render-template-interactive.py \
  templates/mikrotik/routeros-7.x/add-ebgp-neighbor.rsc.j2 \
  --context inventory/SITE001_ebgp.json \
  -o output/SITE001_ebgp_v2.rsc
```

## Как работает ввод значений

### Расширенный режим (YAML-docstring присутствует)

Скрипт выводит:

```
Локальный номер ASN на этом роутере. (пример: 65001): 
```

- **Обязательные** поля (`required: true`) — пустой ввод не принимается (повторный запрос).
- Если указан `default` — показывается в квадратных скобках, Enter → берётся default.
- Валидация по типу:
  - `int` → только целое число.
  - `ip` → валидный IPv4/IPv6 адрес.
  - `cidr` → валидная подсеть.
  - `list[...]` → строка с запятыми или JSON-массив.

### Режим обратной совместимости

| Ввод                                   | Результат                     | Тип          |
|----------------------------------------|-------------------------------|--------------|
| `Enter`                                | Пропуск (default из шаблона)  | —            |
| `65001`                                | Число                         | `int`        |
| `true` / `yes` / `on`                  | Булево                        | `bool`       |
| `10.0.0.1,10.0.0.2`                    | Список                        | `list[str]`  |
| `:json {"key": "value"}`               | Принудительный JSON           | `dict/list`  |
| `:list PL-IN-HQ,PL-IN-BACKUP`          | Принудительный список         | `list[str]`  |
| `:dict role=core location=MOW`         | Принудительный словарь        | `dict`       |

## Рекомендации по шаблонам

Все новые шаблоны должны начинаться с **YAML-docstring**:

```jinja
{#---
name: cisco-add-bgp-neighbor
description: Добавление BGP-соседа на Cisco IOS-XE
vars:
  local_as:
    type: int
    required: true
    desc: Локальный номер ASN
    example: 65001
---#}
```

Это даёт:
- Чёткие подсказки пользователю.
- Валидацию ввода.
- Контроль обязательных параметров.

Старые шаблоны без YAML продолжают работать в режиме совместимости.

## Ограничения

- В режиме совместимости поддерживаются только простые `| default(константа)`.
- Сложные вложенные структуры удобнее вводить через `:json` (старый режим) или как JSON в расширенном.
- Валидация типов ограничена базовыми проверками (ipaddress модуль).
